{
    "label":"Docker-CE-on-CentOS",
    "version":"0.1",
    "vmconfig" : {
        "datacentre" : "",
        "datastore":"",
        "network" : "",
        "host" : "",
        "guestCredentials" : {
            "guestUser" : "root",
            "guestPass" :"password"
        }
    },
    "deployment": [
        {"name": "Swarm Manager",
            "note": "Build Swarm leader from Template",
            "task":{
               "inputTemplate": "DockerCETemplate",
               "outputName": "manager001",
               "outputType": "VM",
               "import":"",
               "networkConfig":{
                    "distro":"centos",
                    "device":"ens192",
                    "address":"10.0.0.101/24",
                    "gateway":"10.0.0.1",
                    "dns":"8.8.8.8",
                    "hostname":"manager01.local"
                },
               "commands": [
                   {
                       "type":"execute",                    
                       "note":"Initialise Docker Swarm",            
                       "cmd":"/usr/bin/docker swarm init",
                       "sudoUser":"root"
                   },
                   {
                       "type":"execute",                    
                       "note":"Backing up swarm key for other nodes",            
                       "cmd":"/usr/bin/docker swarm join-token worker | grep SWMTKN > /tmp/swm.tkn",
                       "sudoUser":"root"
                   },
                   {
                       "type":"download",
                       "filePath":"/tmp/swm.tkn",
                       "resultKey":"jointoken",
                       "delAfterDownload": false
                   }
                ]
            }
        },
        {"name": "Swarm Worker",
            "note": "Add worker",
            "task":{
               "inputTemplate": "DockerEETemplate",
               "outputName": "worker001",
               "outputType": "VM",
               "import":"",
               "networkConfig":{
                  "distro":"centos",
                  "device":"ens192",
                  "address":"10.0.0.102/24",
                  "gateway":"10.0.0.1",
                  "dns":"8.8.8.8",
                  "hostname":"worker01.local"
                },
               "commands": [
                   {
                       "type":"execute",                    
                       "note":"Join Swarm",
                       "execKey":"jointoken",
                       "sudoUser":"root"
                   }
                ]
            }
        },
        {"name": "Swarm Worker",
            "note": "Add worker",
            "task":{
               "inputTemplate": "DockerEETemplate",
               "outputName": "worker002",
               "outputType": "VM",
               "import":"",
               "networkConfig":{
                 "distro":"centos",
                 "device":"ens192",
                 "address":"10.0.0.103/24",
                 "gateway":"10.0.0.1",
                 "dns":"8.8.8.8",
                 "hostname":"worker02.local"
              },
               "commands": [
                   {
                       "type":"execute",                    
                       "note":"Join Swarm",
                       "execKey":"jointoken",
                       "sudoUser":"root"
                   }
                ]
            }
        }
    ]
}